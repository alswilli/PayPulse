<mat-spinner *ngIf="fullLoad" style="margin: auto"></mat-spinner>
<!-- <div style="position: fixed; height: 100px; margin-top: 100px;"></div> -->
<div *ngIf="!fullLoad">
  <div class="addAccountDiv">
    <!-- <form [formGroup]="clientForm"> -->
    <form>
      <h2 *ngIf="listValue.length > 0">Linked Accounts:</h2>
    
      <!-- <pre>
        {{ clientForm.get('myOtherControl').value }}
      </pre> -->
    
      <!-- <mat-selection-list formControlName="myOtherControl"> -->
      <mat-spinner *ngIf="firstLoad" style="margin: auto"></mat-spinner>
      <mat-selection-list *ngIf="!firstLoad">
        <mat-list-option class="mat-primary" *ngFor="let list of listValue" (click)="onAccountChanged(list);" 
        [selected]="preSelection.indexOf(list) > -1" [value]="list" [disabled]="removeAccounts">
          <div fxFlex fxLayout="row">
            <div *ngIf="removeAccounts">
              <mat-icon class="trashIcon" (click)="onDeleteIconClicked(list);">delete</mat-icon> 
            </div>
            <div style="vertical-align: bottom; padding: 3px;">
              {{list}}
            </div>
          </div>
        </mat-list-option>
      </mat-selection-list>
    </form>
    <!-- <p>Bank Account Selected: {{currentAccountName}}</p> -->
    <div>
      <!-- <button mat-raised-button class="addDeleteButtons" routerLink='/linkAccount' color="primary">Add Account</button> -->
      <mr-ngx-plaid-link-button env="sandbox" publicKey="ea1ee62219264cf290c12041f96bba" (Success)="onPlaidSuccess($event)" 
      (Exit)="onPlaidExit($event)" (Load)="onPlaidLoad($event)" (Event)="onPlaidEvent($event)" 
      className="launch-plaid-link-button" buttonText="Add Account" 
      (Click)="onPlaidClick($event)" webhook="https://507ec71083932519eb6c52a27bbe8afd.m.pipedream.net"
      product="transactions"
      [style]="{
        'background-color':'#3f51b5',
        'border-radius':'2px',
        'border':'none',
        'display':'inline-block',
        'cursor':'pointer',
        'color':'white',
        'font-family':'Arial',
        'padding':'16px 31px',
        'text-decoration':'none',
        'text-shadow':'0px 1px 0px #2f6627',
        'margin':'auto',
        'padding':'10px',
        'font-size':'14px'
      }">
      </mr-ngx-plaid-link-button>
      <button mat-flat-button *ngIf="listValue.length > 0" id="removeAccountButton" class="addDeleteButtons" (click)="onRemoveAccountClicked();">Remove Accounts</button>
    </div>
  </div>
  
  <div *ngIf="listValue.length === 0">
    <p>No accounts added! Please add an account using the 'Add Account' button above</p>
  </div>
  
  <div *ngIf="listValue.length > 0">
    <mat-card class="card" *ngFor="let component of majorComponents">
      <mat-card-header>
        <mat-card-title class="mainCardTitle"> {{component.name}} </mat-card-title>
        <mat-card-subtitle> {{component.description}} </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content fxLayoutAlign="center">
        <mat-card fxFlex *ngFor="let card of component.cards">
          <mat-card-header>
            <mat-card-title> {{card.name}} </mat-card-title>
          </mat-card-header>
          <mat-card-content fxLayoutAlign="center">
            <div *ngIf="component.name === 'Transactions' && card.name === 'Recent Transactions'">
              <mat-spinner *ngIf="isLoading" style="margin: auto"></mat-spinner>
              <div *ngIf="!isLoading"> 
                <div *ngIf="parsedTransactions.length === 0">
                  <p>No recent transactions for this month yet!</p>
                </div>
                <p *ngFor="let recentData of parsedTransactions">
                  <span><b>Account Name:</b> {{recentData.accountName}} </span>
                  <span><b>Amount:</b> {{recentData.amount}} </span>
                  <span><b>Transaction Name:</b> {{recentData.transactionName}} </span>
                  <span><b>Category:</b> {{recentData.category}} </span>
                  <span><b>Date:</b> {{recentData.date}} </span>
                </p>
              </div>
            </div>
            <div *ngIf="component.name === 'Budgets' && card.name === 'Top Budgets'">
              <mat-spinner *ngIf="isLoading" style="margin: auto"></mat-spinner>
              <div *ngIf="!isLoading"> 
                <div *ngFor="let budget of top3Budgets">
                  <p fxFlex *ngIf="budget.mainCategory === budget.category3">
                    {{ budget.category }}: {{ budget.category2 }}: <b>{{ budget.category3 }}</b> 
                  </p>
                  <p fxFlex *ngIf="budget.mainCategory === budget.category2">
                    {{ budget.category }}: <b>{{ budget.category2 }}</b> 
                  </p>
                  <p fxFlex *ngIf="budget.mainCategory === budget.category">
                    <b>{{ budget.category }}</b> 
                  </p>
                  <span fxFlex></span>
                  <p fxLayoutAlign="end center" style="margin-right: 10px;">
                    <span *ngIf="(budget.total / (budget.amount)) >= 1" style="color: red;">
                      <b>{{ budget.total }} / {{ (budget.amount) }}</b>
                    </span>
                    <span *ngIf="!((budget.total / (budget.amount)) >= 1) && (budget.total / (budget.amount)) >= 0.75" style="color: orange;">
                      <b>{{ budget.total }} / {{ (budget.amount) }}</b>
                    </span>
                    <span *ngIf="!((budget.total / (budget.amount)) >= 0.75) && (budget.total / (budget.amount)) >= 0" style="color: green;">
                      <b>{{ budget.total }} / {{ (budget.amount) }}</b>
                    </span>
                  </p>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button *ngIf="component.name === 'Transactions'" class="manageButton" routerLink='/transactions'>Manage {{component.name}}</button>
        <button mat-button *ngIf="component.name === 'Budgets'" class="manageButton" routerLink='/budgets'>Manage {{component.name}}</button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>


